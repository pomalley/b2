<!--
my-new-view element

a page to display a list (of books) resulting from a query

Mode can be:
  "library": show the "library list" -- books we want to read
  "bookstore": show the "bookstore list" -- books we want to own
  anything else: show all books
-->
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-icons/maps-icons.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="../bower_components/paper-item/paper-item-body.html">
<link rel="import" href="../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="book-detail.html">

<dom-module id="view-all-books">

  <template>
    <style>
      :host {
        display: block;
        padding: 16px;
      }

      .book-link {
        text-decoration: none;
        color: inherit;
      }

      .book-item {
        background-color: var(--app-primary-light);
      }
      .book-link:nth-of-type(even) .book-item {
        background-color: var(--app-primary-alternate);
      }

      paper-listbox {
        padding: 0;
      }
    </style>

    <app-route
        route="{{route}}"
        pattern="/:mode"
        data="{{routeData}}"></app-route>

    <firebase-query
        id="query"
        app-name="b2"
        path="[[queryPath]]"
        data="{{queryData}}"
    >
    </firebase-query>

    <h1>[[header]]</h1>
    <paper-listbox>
      <template id="repeater" is="dom-repeat" items="{{queryData}}" rendered-item-count="{{numBooks}}" filter="filter">
        <a class="book-link" href$="/book/[[item.$key]]">
          <paper-icon-item class="book-item">
            <iron-icon icon="[[getIcon(item)]]" item-icon></iron-icon>
            <paper-item-body two-line>
              <div>[[item.title]]</div>
              <div secondary>[[item.authors]]</div>
            </paper-item-body>
          </paper-icon-item>
        </a>
      </template>
    </paper-listbox>
    <div>Path: [[queryPath]]</div>

  </template>

  <script>
    Polymer({
      is: 'view-all-books',
      properties: {
        queryPath: String,
        queryData: Object,
        numBooks: {
          type: Number,
          value: "-",
          notify: true
        },
        route: Object,
        routeData: {
          type: Object,
          observer: 'routeDataChanged'
        },
        mode: {
          type: String,
          value: "all",
          observer: 'modeChanged'
        },
        header: {
          type: String,
          computed: 'computeHeader(mode, numBooks)'
        }
      },
      routeDataChanged: function(newRouteData) {
        this.mode = newRouteData.mode || "all";
      },
      modeChanged: function() {
        this.$.repeater.render();
      },
      getIcon: function (book) {
        viewAll = this;
        if (book.want_to_read) {
          return "icons:book";
        } else if (book.read) {
          return "icons:done";
        } else {
          return "maps:local-library";
        }
      },
      filter: function (book) {
        if (this.mode.toLowerCase() === "library") {
          return !!book.want_to_read;
        } else if (this.mode.toLowerCase() === "bookstore") {
          return !!book.want_to_own;
        } else {
          return true;
        }
      },
      computeHeader: function (mode, numBooks) {
        if (mode.toLowerCase() === "library") {
          return "Library list (" + numBooks + " total)";
        } else if (mode.toLowerCase() === "bookstore") {
          return "Bookstore list (" + numBooks + " total)";
        } else {
          return "All books (" + numBooks + " total)";
        }
      }
    });
  </script>
</dom-module>
